{"version":3,"file":"bundle.cjs.js","sources":["../src/utils.js","../src/view.js","../src/scheduler.js","../src/batch.js","../src/store.js","../src/autoEffect.js"],"sourcesContent":["import { useState } from 'react';\n\n// try to find the global object\n// it is window in the DOM and global in NodeJS and React Native\nconst isDOM = typeof window !== 'undefined';\nconst isNative = typeof global !== 'undefined';\nexport const globalObj = isDOM\n  ? window\n  : isNative\n  ? global\n  : undefined;\n\nexport const hasHooks = typeof useState === 'function';\n","import {\n  Component,\n  useState,\n  useEffect,\n  useMemo,\n  memo,\n  useRef,\n} from 'react';\nimport {\n  observe,\n  unobserve,\n  raw,\n  isObservable,\n} from '@frontity/observer-util';\n\nimport { hasHooks } from './utils';\n\nexport let isInsideFunctionComponent = false;\nexport let isInsideClassComponentRender = false;\nexport let isInsideFunctionComponentWithoutHooks = false;\nconst COMPONENT = Symbol('owner component');\n\nfunction mapStateToStores(state) {\n  // find store properties and map them to their none observable raw value\n  // to do not trigger none static this.setState calls\n  // from the static getDerivedStateFromProps lifecycle method\n  const component = state[COMPONENT];\n  return Object.keys(component)\n    .map((key) => component[key])\n    .filter(isObservable)\n    .map(raw);\n}\n\nexport function view(Comp) {\n  const isStatelessComp = !(\n    Comp.prototype && Comp.prototype.isReactComponent\n  );\n\n  let ReactiveComp;\n\n  if (isStatelessComp && hasHooks) {\n    // use a hook based reactive wrapper when we can\n    ReactiveComp = (props) => {\n      // use a dummy setState to update the component\n      const [, setState] = useState();\n      // use a ref to store the reaction\n      const reaction = useRef();\n      // create a memoized reactive wrapper of the original component (render)\n      // at the very first run of the component function\n      const render = useMemo(\n        () => {\n          reaction.current = observe(Comp, {\n            scheduler: () => {\n              // trigger a new rerender if the component has been mounted\n              if (reaction.current.mounted) setState({});\n              // mark it as changed if the component has not been mounted yet\n              else reaction.current.changedBeforeMounted = true;\n            },\n            lazy: true,\n          });\n          // initilalize a flag to know if the component was finally mounted\n          reaction.current.mounted = false;\n          // initilalize a flag to know if the was reaction was invalidated\n          // before the component was mounted\n          reaction.current.changedBeforeMounted = false;\n          return reaction.current;\n        },\n        // Adding the original Comp here is necessary to make React Hot Reload work\n        // it does not affect behavior otherwise\n        [Comp],\n      );\n\n      useEffect(() => {\n        // mark the component as mounted.\n        reaction.current.mounted = true;\n\n        // if there was a change before the component was mounted, trigger a\n        // new rerender\n        if (reaction.current.changedBeforeMounted) setState({});\n\n        // cleanup the reactive connections after the very last render of the\n        return () => unobserve(reaction.current);\n      }, []);\n\n      // the isInsideFunctionComponent flag is used to toggle `store` behavior\n      // based on where it was called from\n      isInsideFunctionComponent = true;\n      try {\n        // run the reactive render instead of the original one\n        return render(props);\n      } finally {\n        isInsideFunctionComponent = false;\n      }\n    };\n  } else {\n    const BaseComp = isStatelessComp ? Component : Comp;\n    // a HOC which overwrites render, shouldComponentUpdate and componentWillUnmount\n    // it decides when to run the new reactive methods and when to proxy to the original methods\n    class ReactiveClassComp extends BaseComp {\n      constructor(props, context) {\n        super(props, context);\n\n        this.state = this.state || {};\n        this.state[COMPONENT] = this;\n\n        // create a reactive render for the component\n        this.render = observe(this.render, {\n          scheduler: () => this.setState({}),\n          lazy: true,\n        });\n      }\n\n      render() {\n        isInsideClassComponentRender = !isStatelessComp;\n        isInsideFunctionComponentWithoutHooks = isStatelessComp;\n        try {\n          return isStatelessComp\n            ? Comp(this.props, this.context)\n            : super.render();\n        } finally {\n          isInsideClassComponentRender = false;\n          isInsideFunctionComponentWithoutHooks = false;\n        }\n      }\n\n      // react should trigger updates on prop changes, while easyState handles store changes\n      shouldComponentUpdate(nextProps, nextState) {\n        const { props, state } = this;\n\n        // respect the case when the user defines a shouldComponentUpdate\n        if (super.shouldComponentUpdate) {\n          return super.shouldComponentUpdate(nextProps, nextState);\n        }\n\n        // return true if it is a reactive render or state changes\n        if (state !== nextState) {\n          return true;\n        }\n\n        // the component should update if any of its props shallowly changed value\n        const keys = Object.keys(props);\n        const nextKeys = Object.keys(nextProps);\n        return (\n          nextKeys.length !== keys.length ||\n          nextKeys.some((key) => props[key] !== nextProps[key])\n        );\n      }\n\n      // add a custom deriveStoresFromProps lifecyle method\n      static getDerivedStateFromProps(props, state) {\n        if (super.deriveStoresFromProps) {\n          // inject all local stores and let the user mutate them directly\n          const stores = mapStateToStores(state);\n          super.deriveStoresFromProps(props, ...stores);\n        }\n        // respect user defined getDerivedStateFromProps\n        if (super.getDerivedStateFromProps) {\n          return super.getDerivedStateFromProps(props, state);\n        }\n        return null;\n      }\n\n      componentWillUnmount() {\n        // call user defined componentWillUnmount\n        if (super.componentWillUnmount) {\n          super.componentWillUnmount();\n        }\n        // clean up memory used by Easy State\n        unobserve(this.render);\n      }\n    }\n\n    ReactiveComp = ReactiveClassComp;\n  }\n\n  ReactiveComp.displayName = Comp.displayName || Comp.name;\n  // static props are inherited by class components,\n  // but have to be copied for function components\n  if (isStatelessComp) {\n    Object.keys(Comp).forEach((key) => {\n      ReactiveComp[key] = Comp[key];\n    });\n  }\n\n  return isStatelessComp && hasHooks\n    ? memo(ReactiveComp)\n    : ReactiveComp;\n}\n","const taskQueue = new Set();\n\nconst scheduler = {\n  isOn: false,\n  add(task) {\n    if (scheduler.isOn) {\n      taskQueue.add(task);\n    } else {\n      task();\n    }\n  },\n  flush() {\n    taskQueue.forEach((task) => task());\n    taskQueue.clear();\n  },\n  on() {\n    scheduler.isOn = true;\n  },\n  off() {\n    scheduler.isOn = false;\n  },\n};\n\nexport default scheduler;\n","/* eslint camelcase: 0 */\n\n// react-platform is set to either react-dom or react-native during test and execution\n// eslint-disable-next-line import/no-unresolved\nimport { unstable_batchedUpdates } from 'react-platform';\nimport { globalObj } from './utils';\nimport scheduler from './scheduler';\n\n// this runs the passed function and delays all re-renders\n// until the function is finished running\n// react renders are batched by unstable_batchedUpdates\n// autoEffects and other custom reactions are batched by our scheduler\nexport function batch(fn, ctx, args) {\n  // do not apply scheduler logic if it is already applied from a parent function\n  // it would flush in the middle of the parent's batch\n  if (scheduler.isOn) {\n    return unstable_batchedUpdates(() => fn.apply(ctx, args));\n  }\n  try {\n    scheduler.on();\n    return unstable_batchedUpdates(() => fn.apply(ctx, args));\n  } finally {\n    scheduler.flush();\n    scheduler.off();\n  }\n}\n\n// this creates and returns a batched version of the passed function\n// the cache is necessary to always map the same thing to the same function\n// which makes sure that addEventListener/removeEventListener pairs don't break\nconst cache = new WeakMap();\nfunction batchFn(fn) {\n  if (typeof fn !== 'function') {\n    return fn;\n  }\n  let batched = cache.get(fn);\n  if (!batched) {\n    batched = new Proxy(fn, {\n      apply(target, thisArg, args) {\n        return batch(target, thisArg, args);\n      },\n    });\n    cache.set(fn, batched);\n  }\n  return batched;\n}\n\nfunction batchMethodCallbacks(obj, method) {\n  const descriptor = Object.getOwnPropertyDescriptor(obj, method);\n  if (\n    descriptor &&\n    descriptor.writable &&\n    typeof descriptor.value === 'function'\n  ) {\n    obj[method] = new Proxy(descriptor.value, {\n      apply(target, ctx, args) {\n        return Reflect.apply(target, ctx, args.map(batchFn));\n      },\n    });\n  }\n}\n\n// batched obj.addEventListener(cb) like callbacks\nfunction batchMethodsCallbacks(obj, methods) {\n  methods.forEach((method) => batchMethodCallbacks(obj, method));\n}\n\nfunction batchMethod(obj, method) {\n  const descriptor = Object.getOwnPropertyDescriptor(obj, method);\n  if (!descriptor) {\n    return;\n  }\n  const { value, writable, set, configurable } = descriptor;\n\n  if (configurable && typeof set === 'function') {\n    Object.defineProperty(obj, method, {\n      ...descriptor,\n      set: batchFn(set),\n    });\n  } else if (writable && typeof value === 'function') {\n    obj[method] = batchFn(value);\n  }\n}\n\n// batches obj.onevent = fn like calls and store methods\nexport function batchMethods(obj, methods) {\n  methods = methods || Object.getOwnPropertyNames(obj);\n  methods.forEach((method) => batchMethod(obj, method));\n  return obj;\n}\n\n// do a sync batching for the most common task sources\n// this should be removed when React's own batching is improved in the future\n\n// batch timer functions\nbatchMethodsCallbacks(globalObj, [\n  'setTimeout',\n  'setInterval',\n  'requestAnimationFrame',\n  'requestIdleCallback',\n]);\n\nif (globalObj.Promise) {\n  batchMethodsCallbacks(Promise.prototype, ['then', 'catch']);\n}\n\n// Event listener batching causes an input caret jumping bug:\n// https://github.com/RisingStack/react-easy-state/issues/92.\n// This part has to be commented out to prevent that bug.\n// React batches setStates in its event listeners anyways\n// so this commenting this part out is not a huge issue.\n\n// batch addEventListener calls\n/* if (globalObj.EventTarget) {\n  batchMethodsCallbacks(EventTarget.prototype, [\n    'addEventListener',\n    'removeEventListener',\n  ]);\n} */\n\n// this batches websocket event handlers\nif (globalObj.WebSocket) {\n  batchMethods(WebSocket.prototype, [\n    'onopen',\n    'onmessage',\n    'onerror',\n    'onclose',\n  ]);\n}\n\n// HTTP event handlers are usually wrapped by Promises, which is covered above\n","import { useMemo } from 'react';\nimport { observable } from '@frontity/observer-util';\n\nimport { batchMethods } from './batch';\nimport {\n  isInsideFunctionComponent,\n  isInsideClassComponentRender,\n  isInsideFunctionComponentWithoutHooks,\n} from './view';\n\nfunction createStore(obj, options) {\n  return batchMethods(observable(obj, options));\n}\n\nexport function store(obj, options) {\n  // do not create new versions of the store on every render\n  // if it is a local store in a function component\n  // create a memoized store at the first call instead\n  if (isInsideFunctionComponent) {\n    // useMemo is not a semantic guarantee\n    // In the future, React may choose to “forget” some previously memoized values and recalculate them on next render\n    // see this docs for more explanation: https://reactjs.org/docs/hooks-reference.html#usememo\n    return useMemo(() => createStore(obj, options), []);\n  }\n  if (isInsideFunctionComponentWithoutHooks) {\n    throw new Error(\n      'You cannot use state inside a function component with a pre-hooks version of React. Please update your React version to at least v16.8.0 to use this feature.',\n    );\n  }\n  if (isInsideClassComponentRender) {\n    throw new Error(\n      'You cannot use state inside a render of a class component. Please create your store outside of the render function.',\n    );\n  }\n  return createStore(obj, options);\n}\n","import { useEffect } from 'react';\nimport { observe, unobserve } from '@frontity/observer-util';\nimport scheduler from './scheduler';\n\nimport {\n  isInsideFunctionComponent,\n  isInsideClassComponentRender,\n  isInsideFunctionComponentWithoutHooks,\n} from './view';\n\nexport function autoEffect(fn, deps = []) {\n  if (isInsideFunctionComponentWithoutHooks) {\n    throw new Error(\n      'You cannot use autoEffect inside a function component with a pre-hooks version of React. Please update your React version to at least v16.8.0 to use this feature.',\n    );\n  }\n  if (isInsideClassComponentRender) {\n    throw new Error(\n      'You cannot use autoEffect inside a render of a class component. Please use it in the constructor or lifecycle methods instead.',\n    );\n  }\n\n  if (isInsideFunctionComponent) {\n    return useEffect(() => {\n      const reaction = observe(fn, {\n        scheduler: scheduler.add,\n      });\n      return () => unobserve(reaction);\n    }, deps);\n  }\n\n  return observe(fn, {\n    scheduler: scheduler.add,\n  });\n}\n\nexport { unobserve as clearEffect };\n"],"names":["isDOM","window","isNative","global","globalObj","undefined","hasHooks","useState","isInsideFunctionComponent","isInsideClassComponentRender","isInsideFunctionComponentWithoutHooks","COMPONENT","Symbol","mapStateToStores","state","component","Object","keys","map","key","filter","isObservable","raw","view","Comp","isStatelessComp","prototype","isReactComponent","ReactiveComp","props","setState","reaction","useRef","render","useMemo","current","observe","scheduler","mounted","changedBeforeMounted","lazy","useEffect","unobserve","BaseComp","Component","ReactiveClassComp","constructor","context","shouldComponentUpdate","nextProps","nextState","nextKeys","length","some","getDerivedStateFromProps","deriveStoresFromProps","stores","componentWillUnmount","displayName","name","forEach","memo","taskQueue","Set","isOn","add","task","flush","clear","on","off","batch","fn","ctx","args","unstable_batchedUpdates","apply","cache","WeakMap","batchFn","batched","get","Proxy","target","thisArg","set","batchMethodCallbacks","obj","method","descriptor","getOwnPropertyDescriptor","writable","value","Reflect","batchMethodsCallbacks","methods","batchMethod","configurable","defineProperty","batchMethods","getOwnPropertyNames","Promise","WebSocket","createStore","options","observable","store","Error","autoEffect","deps"],"mappings":"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"}